<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>EEG Plot</title>
    <link href="layout.css" rel="stylesheet" type="text/css"></link>
    <!--[if IE]><script language="javascript" type="text/javascript" src="media/js/excanvas.pack.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="media/js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="media/js/flot/jquery.flot.js"></script>
 </head>
    <body>
    <h1>EEG Plot</h1>

    <div style="float:left">
        <div id="placeholder" style="width:1000px;height:400px;"></div>
    </div>

    <div id="miniature" style="float:right;margin-right:20px;margin-top:-120px">
      <div id="overview" style="width:166px;height:100px"></div>

      <p id="overviewLegend" style="margin-left:10px"></p>
    </div>


<script id="source" language="javascript" type="text/javascript">
$(function () {
    function getData(data, x1, x2) {
        var d = [];
        for(var i = 0; i < data.length; i++) {
            d.push([]);
        }
        for(var i = 0; i < data.length; i++) {
            for (var j = x1; j < x2; j++)
                d[i][j] = data[i][j];
        }

        return d
    };

    $.get("http://localhost:8000/plot/",
        function(data){
          var options = {
            legend: {show: false},
            points: {show: true},
            lines: {show: true},
            yaxis: {ticks: 10},
            selection: {mode: "x"}
          };
          data = eval(data);

          $.plot($("#placeholder"), data, options);

          var overview = $.plot($("#overview"), data, {
              lines: { show: true, lineWidth: 1 },
              shadowSize: 0,
              xaxis: { ticks: 4 },
              yaxis: { ticks: 3, min: -2, max: 2 },
              grid: { color: "#999" },
              selection: { mode: "x" }
          });

          // now connect the two
          
          $("#placeholder").bind("plotselected", function (event, ranges) {
              // make sure the indecies are integers
              ranges.xaxis.from = parseInt(ranges.xaxis.from);
              ranges.xaxis.to = parseInt(ranges.xaxis.to);
              plot = $.plot($("#placeholder"), getData(data, ranges.xaxis.from, ranges.xaxis.to),
                          $.extend(true, {}, options, {
                              xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to-1 }
                          }));
              
              // don't fire event on the overview to prevent eternal loop
              overview.setSelection(ranges, true);
          });
          $("#overview").bind("plotselected", function (event, ranges) {
              plot.setSelection(ranges);
          });
    });
});
</script>

 </body>
</html>
